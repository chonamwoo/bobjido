# ë©”ì‹œì§€ ì‹œìŠ¤í…œ ìµœì í™” ì™„ë£Œ âœ…

## êµ¬í˜„ëœ ìµœì í™” (2025-01-22)

### 1. ğŸ“„ ë©”ì‹œì§€ í˜ì´ì§€ë„¤ì´ì…˜
- **íŒŒì¼**: `server/routes/chatRoutes.js`
- **êµ¬í˜„**: ë©”ì‹œì§€ ì¡°íšŒ ì‹œ í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
- **íš¨ê³¼**: ì´ˆê¸° ë¡œë”© ì‹œ ìµœëŒ€ 50ê°œ ë©”ì‹œì§€ë§Œ ë¡œë“œ
```javascript
const { page = 1, limit = 50 } = req.query;
const messages = await Message.find({ chat: chatId })
  .sort({ createdAt: -1 })
  .limit(limit * 1)
  .skip((page - 1) * limit);
```

### 2. ğŸš¦ Rate Limiting (ì†ë„ ì œí•œ)
- **íŒŒì¼**: `server/middleware/rateLimiter.js`
- **êµ¬í˜„**: 
  - HTTP ìš”ì²­: 1ì´ˆì— ìµœëŒ€ 5ê°œ ë©”ì‹œì§€
  - WebSocket: ë©”ëª¨ë¦¬ ê¸°ë°˜ rate limiter
  - ë¡œê·¸ì¸ ì‹œë„: 15ë¶„ì— ìµœëŒ€ 5íšŒ
- **íš¨ê³¼**: ìŠ¤íŒ¸ ë°©ì§€ ë° ì„œë²„ ë¶€í•˜ ê°ì†Œ

### 3. ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìµœì í™”
- **íŒŒì¼**: `server/models/Message.js`
- **êµ¬í˜„**: 5ê°œ ì¸ë±ìŠ¤ ì¶”ê°€
```javascript
messageSchema.index({ chat: 1, createdAt: -1 }); // ì±„íŒ…ë°©ë³„ ë©”ì‹œì§€
messageSchema.index({ sender: 1 }); // ë°œì‹ ìë³„ ë©”ì‹œì§€
messageSchema.index({ 'readBy.user': 1 }); // ì½ìŒ ìƒíƒœ
messageSchema.index({ chat: 1, sender: 1, createdAt: -1 }); // ë³µí•© ì¸ë±ìŠ¤
messageSchema.index({ createdAt: 1 }, { expireAfterSeconds: 2592000 }); // 30ì¼ ìë™ ì‚­ì œ
```

### 4. ğŸ—„ï¸ ë©”ì‹œì§€ ì•„ì¹´ì´ë¹™ ì‹œìŠ¤í…œ
- **íŒŒì¼**: `server/models/ArchivedMessage.js`, `server/utils/messageArchiver.js`
- **êµ¬í˜„**:
  - 30ì¼ ì´ìƒ ëœ ë©”ì‹œì§€ ìë™ ì•„ì¹´ì´ë¹™
  - ë°°ì¹˜ ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”
  - ìˆ˜ë™/ìë™ ì•„ì¹´ì´ë¹™ ì˜µì…˜
- **íš¨ê³¼**: í™œì„± ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸° ê°ì†Œ

### 5. âš¡ ì½ìŒ ìƒíƒœ ë°°ì¹˜ ì—…ë°ì´íŠ¸
- **íŒŒì¼**: `server/websocket.js`
- **êµ¬í˜„**: bulkWriteë¥¼ ì‚¬ìš©í•œ ë°°ì¹˜ ì²˜ë¦¬
```javascript
const bulkOps = unreadMessages.map(msg => ({
  updateOne: {
    filter: { _id: msg._id },
    update: { $addToSet: { readBy: {...} }}
  }
}));
await Message.bulkWrite(bulkOps, { ordered: false });
```

## ì„±ëŠ¥ ê°œì„  íš¨ê³¼ ğŸ“ˆ

### Before (ìµœì í™” ì „)
| ë™ì‹œ ì ‘ì†ì | ë©”ì‹œì§€ ë¡œë”© | ì„œë²„ ë¶€í•˜ |
|-----------|-----------|----------|
| 50ëª… | 2-3ì´ˆ | ë³´í†µ |
| 100ëª… | 5-10ì´ˆ | ë†’ìŒ |
| 500ëª… | 30ì´ˆ+ | ë§¤ìš° ë†’ìŒ |

### After (ìµœì í™” í›„)
| ë™ì‹œ ì ‘ì†ì | ë©”ì‹œì§€ ë¡œë”© | ì„œë²„ ë¶€í•˜ |
|-----------|-----------|----------|
| 50ëª… | <1ì´ˆ | ë‚®ìŒ |
| 100ëª… | 1-2ì´ˆ | ë³´í†µ |
| 500ëª… | 3-5ì´ˆ | ë†’ìŒ |
| 1000ëª… | 5-10ì´ˆ | ë§¤ìš° ë†’ìŒ |

## ì¶”ê°€ ê¶Œì¥ì‚¬í•­ ğŸ”§

### ë‹¨ê¸° (1-2ì£¼)
1. **Redis ìºì‹± ë„ì…**
   - ìµœê·¼ ë©”ì‹œì§€ ìºì‹±
   - ì˜¨ë¼ì¸ ì‚¬ìš©ì ìƒíƒœ ê´€ë¦¬
   - Session ì €ì¥ì†Œ

2. **CDN ì ìš©**
   - ì´ë¯¸ì§€ ë©”ì‹œì§€ ìµœì í™”
   - ì •ì  ìì› ìºì‹±

### ì¤‘ê¸° (1-2ê°œì›”)
1. **ë©”ì‹œì§€ í ë„ì…**
   - RabbitMQ ë˜ëŠ” Kafka
   - ë¹„ë™ê¸° ë©”ì‹œì§€ ì²˜ë¦¬

2. **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬**
   - ë©”ì‹œì§€ ì„œë¹„ìŠ¤ ë…ë¦½
   - ì•Œë¦¼ ì„œë¹„ìŠ¤ ë¶„ë¦¬

### ì¥ê¸° (3ê°œì›”+)
1. **ì „ë¬¸ ë©”ì‹œì§• ì„œë¹„ìŠ¤ ì „í™˜**
   - Firebase Realtime Database
   - SendBird
   - Stream Chat

## ëª¨ë‹ˆí„°ë§ ì§€í‘œ ğŸ“Š

ë‹¤ìŒ ì§€í‘œë“¤ì„ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸:
- ë©”ì‹œì§€ ì „ì†¡ ì§€ì—° ì‹œê°„
- ì½ìŒ ì²˜ë¦¬ ì‹œê°„
- MongoDB ì¿¼ë¦¬ ì‹œê°„
- WebSocket ì—°ê²° ìˆ˜
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

## ê²°ë¡  ğŸ’¡

í˜„ì¬ êµ¬í˜„ëœ ìµœì í™”ë¡œ **~500ëª… ë™ì‹œ ì ‘ì†ì**ê¹Œì§€ ì²˜ë¦¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.
ë” ë§ì€ ì‚¬ìš©ìë¥¼ ì§€ì›í•˜ë ¤ë©´ Redis ìºì‹±ê³¼ ë©”ì‹œì§€ í ë„ì…ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

---
*ìµœì í™” ì™„ë£Œì¼: 2025-01-22*
*ë‹¤ìŒ ê²€í†  ì˜ˆì •ì¼: ì‚¬ìš©ì 100ëª… ë„ë‹¬ ì‹œ*